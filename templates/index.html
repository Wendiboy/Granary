<!doctype html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Finance App - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–∞–º–∏</title>
    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ HTMX -->
    <script src="https://unpkg.com/htmx.org@2.0.4"></script>
    <!-- –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–ª—è JSON –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <script src="https://unpkg.com/htmx.org@2.0.4/dist/ext/json-enc.js"></script>
    <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∏–∫–æ–Ω–æ–∫ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —É–¥–∞–ª–µ–Ω–∏—è -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div style="max-width: 1200px; margin: 0 auto; padding: 20px;">
        <h1>üìä –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏</h1>
        
        <!-- –§–æ—Ä–º–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ -->
        <div style="background: #f5f5f5; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
            <h2>‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ä–∞—Å—Ö–æ–¥</h2>
            <form id="add-spend-form"
                  hx-post="/spends"
                  hx-ext="json-enc"
                  hx-target="#spends-table tbody"
                  hx-swap="afterbegin"
                  hx-on::after-request="this.reset()">
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
                        <select name="category" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                            <option value="–ï–¥–∞">üçé –ï–¥–∞</option>
                            <option value="–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç">üöó –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</option>
                            <option value="–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è">üé¨ –†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è</option>
                            <option value="–ñ–∏–ª—å–µ">üè† –ñ–∏–ª—å–µ</option>
                            <option value="–ó–¥–æ—Ä–æ–≤—å–µ">üè• –ó–¥–æ—Ä–æ–≤—å–µ</option>
                            <option value="–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ">üìö –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</option>
                            <option value="–î—Ä—É–≥–æ–µ">üì¶ –î—Ä—É–≥–æ–µ</option>
                        </select>
                    </div>
                    
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">–°—É–º–º–∞ (‚ÇΩ):</label>
                        <input type="number" 
                               name="amount" 
                               placeholder="0.00" 
                               step="0.01"
                               min="0"
                               style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;" 
                               required />
                    </div>
                    
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">–î–∞—Ç–∞:</label>
                        <input type="date" 
                               name="date" 
                               style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;" 
                               required />
                    </div>
                    
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                        <input type="text" 
                               name="description" 
                               placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ" 
                               style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;" 
                               required />
                    </div>
                </div>
                
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:</label>
                    <textarea name="notes" 
                              placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏..." 
                              rows="3"
                              style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px; resize: vertical;"></textarea>
                </div>
                
                <button type="submit" 
                        style="margin-top: 15px; padding: 10px 25px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">
                    <i class="fas fa-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥
                </button>
                
                <button type="reset" 
                        style="margin-top: 15px; margin-left: 10px; padding: 10px 25px; background: #f44336; color: white; border: none; border-radius: 5px; cursor: pointer;">
                    <i class="fas fa-times"></i> –û—á–∏—Å—Ç–∏—Ç—å
                </button>
            </form>
        </div>
        
        <!-- –ë–ª–æ–∫ —Å —Ç–∞–±–ª–∏—Ü–µ–π —Ä–∞—Å—Ö–æ–¥–æ–≤ -->
        <div style="background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 20px; border-bottom: 1px solid #eee;">
                <h2 style="margin: 0;">üìã –ò—Å—Ç–æ—Ä–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤</h2>
                <div>
                    <button hx-get="/spends" 
                            hx-target="#spends-table"
                            hx-indicator="#loading-spinner"
                            style="padding: 8px 15px; background: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å
                    </button>
                    
                    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
                    <span id="loading-spinner" class="htmx-indicator" style="margin-left: 10px;">
                        <i class="fas fa-spinner fa-spin"></i> –ó–∞–≥—Ä—É–∑–∫–∞...
                    </span>
                </div>
            </div>
            
            <!-- –¢–∞–±–ª–∏—Ü–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –±–∞–∑—ã -->
            <div id="spends-table" hx-get="/spends" hx-trigger="load">
                <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
                <div style="text-align: center; padding: 40px;">
                    <i class="fas fa-spinner fa-spin fa-2x"></i>
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
                </div>
            </div>
        </div>
        
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–ø—Ä–∏–º–µ—Ä, –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å) -->
        <div style="margin-top: 30px; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
            <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; text-align: center;">
                <h3 style="color: #1976d2; margin: 0 0 10px 0;">üí∞ –û–±—â–∞—è —Å—É–º–º–∞</h3>
                <p id="total-amount" style="font-size: 24px; font-weight: bold; color: #1976d2;">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                <button hx-get="/stats/total" 
                        hx-target="#total-amount"
                        style="padding: 5px 10px; background: #1976d2; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">
                    –û–±–Ω–æ–≤–∏—Ç—å
                </button>
            </div>
            
            <div style="background: #f3e5f5; padding: 15px; border-radius: 10px; text-align: center;">
                <h3 style="color: #7b1fa2; margin: 0 0 10px 0;">üìà –í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π</h3>
                <p id="total-count" style="font-size: 24px; font-weight: bold; color: #7b1fa2;">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                <button hx-get="/stats/count" 
                        hx-target="#total-count"
                        style="padding: 5px 10px; background: #7b1fa2; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">
                    –û–±–Ω–æ–≤–∏—Ç—å
                </button>
            </div>
        </div>
    </div>
    
    <!-- –®–∞–±–ª–æ–Ω –¥–ª—è —Å—Ç—Ä–æ–∫–∏ —Ç–∞–±–ª–∏—Ü—ã (–±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è HTMX) -->
    <template id="spend-row-template">
        <tr style="transition: background-color 0.3s;">
            <td style="padding: 12px; border-bottom: 1px solid #eee; text-align: center;"></td>
            <td style="padding: 12px; border-bottom: 1px solid #eee;"></td>
            <td style="padding: 12px; border-bottom: 1px solid #eee; text-align: right; font-weight: bold;"></td>
            <td style="padding: 12px; border-bottom: 1px solid #eee;"></td>
            <td style="padding: 12px; border-bottom: 1px solid #eee;"></td>
            <td style="padding: 12px; border-bottom: 1px solid #eee; text-align: center;">
                <button class="delete-btn" style="padding: 5px 10px; background: #ffebee; color: #c62828; border: 1px solid #ffcdd2; border-radius: 3px; cursor: pointer;">
                    <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                </button>
            </td>
        </tr>
    </template>

    <script>
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ –ø–æ–ª–µ –¥–∞—Ç—ã
        document.addEventListener('DOMContentLoaded', function() {
            const dateField = document.querySelector('input[name="date"]');
            const today = new Date().toISOString().split('T')[0];
            dateField.value = today;
            
            // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏
            document.body.addEventListener('htmx:afterSwap', function(event) {
                if (event.target.id === 'spends-table') {
                    // –ù–∞—Ö–æ–¥–∏–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É –∏ –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –µ–µ
                    const firstRow = event.target.querySelector('tbody tr:first-child');
                    if (firstRow) {
                        firstRow.style.backgroundColor = '#e8f5e9';
                        setTimeout(() => {
                            firstRow.style.backgroundColor = '';
                        }, 2000);
                    }
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
            document.body.addEventListener('htmx:responseError', function(event) {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö: ' + (event.detail.xhr.statusText || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
            });
        });
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã (–¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ —Ç–∞–±–ª–∏—Ü–µ)
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å—É–º–º—ã
        function formatAmount(amount) {
            return new Intl.NumberFormat('ru-RU', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(amount) + ' ‚ÇΩ';
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∫–æ–Ω–∫–∏ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        function getCategoryIcon(category) {
            const icons = {
                '–ï–¥–∞': 'üçé',
                '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç': 'üöó',
                '–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è': 'üé¨',
                '–ñ–∏–ª—å–µ': 'üè†',
                '–ó–¥–æ—Ä–æ–≤—å–µ': 'üè•',
                '–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ': 'üìö',
                '–î—Ä—É–≥–æ–µ': 'üì¶'
            };
            return icons[category] || 'üìù';
        }
    </script>
    
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            background-color: #f8f9fa;
            color: #333;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            background-color: #f1f8e9;
        }
        
        th {
            padding: 15px;
            text-align: left;
            border-bottom: 2px solid #c8e6c9;
            color: #2e7d32;
            font-weight: 600;
        }
        
        tbody tr:hover {
            background-color: #f5f5f5;
        }
        
        .category-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π */
        .category-–ï–¥–∞ { background: #e8f5e8; color: #2e7d32; }
        .category-–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç { background: #e3f2fd; color: #1565c0; }
        .category-–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è { background: #f3e5f5; color: #7b1fa2; }
        .category-–ñ–∏–ª—å–µ { background: #fff3e0; color: #ef6c00; }
        .category-–ó–¥–æ—Ä–æ–≤—å–µ { background: #ffebee; color: #c62828; }
        .category-–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ { background: #e0f7fa; color: #006064; }
        .category-–î—Ä—É–≥–æ–µ { background: #f5f5f5; color: #616161; }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ */
        .htmx-indicator {
            opacity: 0;
            transition: opacity 200ms ease-in;
        }
        
        .htmx-request .htmx-indicator {
            opacity: 1;
        }
        
        .htmx-request.htmx-indicator {
            opacity: 1;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
        button {
            transition: all 0.3s ease;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .delete-btn:hover {
            background-color: #ffcdd2 !important;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            table {
                display: block;
                overflow-x: auto;
            }
            
            h1 {
                font-size: 24px;
            }
            
            h2 {
                font-size: 20px;
            }
        }
    </style>
</body>
</html>