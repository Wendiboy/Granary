<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞–º–∏</title>
    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10" integrity="sha384-D1Kt99CQMDuVetoL1lrYwg5t+9QdHe7NLX/SoJYkXDFfX37iInKRy5xLSi8nO7UC" crossorigin="anonymous"></script>
    <!-- –ë–µ–∑ HTMX JSON Extension -->
    <script src="https://unpkg.com/htmx.org@1.9.10/dist/ext/json-enc.js"></script>
    <!-- Bootstrap –¥–ª—è —Å—Ç–∏–ª–µ–π -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <style>
        :root {
            --bs-body-bg: #f8f9fa;
        }
        .account-card {
            transition: all 0.3s ease;
            border-left: 4px solid #6c757d;
        }
        .account-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .balance-positive {
            color: #198754;
            font-weight: 600;
        }
        .balance-negative {
            color: #dc3545;
            font-weight: 600;
        }
        .account-type-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
        }
        .color-preview {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
            border: 1px solid #dee2e6;
        }
        .htmx-indicator {
            opacity: 0;
            transition: opacity 200ms ease-in;
        }
        .htmx-request .htmx-indicator {
            opacity: 1;
        }
        .htmx-request.htmx-indicator {
            opacity: 1;
        }
        .cursor-pointer {
            cursor: pointer;
        }
        .modal-backdrop {
            z-index: 1040 !important;
        }
        .modal {
            z-index: 1050 !important;
        }
        .hidden-account {
            opacity: 0.6;
        }
        .account-icon {
            font-size: 1.5rem;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="container py-4">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∫–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="h3">
                <i class="bi bi-wallet2 me-2"></i>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞–º–∏
                <span class="htmx-indicator spinner-border spinner-border-sm text-primary ms-2" role="status">
                    <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                </span>
            </h1>
            <div>
                <button class="btn btn-outline-secondary me-2" onclick="toggleHiddenAccounts()">
                    <i class="bi bi-eye-slash"></i>
                </button>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createModal">
                    <i class="bi bi-plus-circle me-1"></i>–î–æ–±–∞–≤–∏—Ç—å —Å—á—ë—Ç
                </button>
            </div>
        </div>

        <!-- –°–ø–∏—Å–æ–∫ —Å—á–µ—Ç–æ–≤ -->
        <div id="accounts-list">
            <div class="text-center">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—á–µ—Ç–æ–≤...</span>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è —Å—á–µ—Ç–∞ -->
        <div class="modal fade" id="createModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å—á—ë—Ç–∞</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
                    </div>
                    <div class="modal-body">
                        <form id="createForm" >
                            <div class="row g-3">
                                <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ -->
                                <div class="col-md-6">
                                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Å—á—ë—Ç–∞ *</label>
                                    <input type="text" class="form-control" id="create-name" required maxlength="100">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">–ë–∞–Ω–∫</label>
                                    <input type="text" class="form-control" id="create-bank_name" maxlength="100">
                                </div>
                                
                                <div class="col-md-6">
                                    <label class="form-label">–¢–∏–ø —Å—á—ë—Ç–∞ *</label>
                                    <select class="form-select" id="create-type" required>
                                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø...</option>
                                        <option value="cash">–ù–∞–ª–∏—á–Ω—ã–µ</option>
                                        <option value="debit_card">–î–µ–±–µ—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞</option>
                                        <option value="credit_card">–ö—Ä–µ–¥–∏—Ç–Ω–∞—è –∫–∞—Ä—Ç–∞</option>
                                        <option value="savings">–ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π —Å—á—ë—Ç</option>
                                        <option value="investment">–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</option>
                                        <option value="deposit">–í–∫–ª–∞–¥</option>
                                        <option value="loan">–ö—Ä–µ–¥–∏—Ç</option>
                                        <option value="crypto">–ö—Ä–∏–ø—Ç–æ</option>
                                        <option value="other">–î—Ä—É–≥–æ–µ</option>
                                    </select>
                                </div>
                                
                                <div class="col-md-6">
                                    <label class="form-label">–í–∞–ª—é—Ç–∞ *</label>
                                    <select class="form-select" id="create-currency" required>
                                        <option value="RUB">RUB - –†–æ—Å—Å–∏–π—Å–∫–∏–π —Ä—É–±–ª—å</option>
                                        <option value="USD">USD - –î–æ–ª–ª–∞—Ä –°–®–ê</option>
                                        <option value="EUR">EUR - –ï–≤—Ä–æ</option>
                                        <option value="BTC">BTC - –ë–∏—Ç–∫–æ–∏–Ω</option>
                                        <option value="ETH">ETH - –≠—Ñ–∏—Ä–∏—É–º</option>
                                    </select>
                                </div>
                                
                                <div class="col-md-6">
                                    <label class="form-label">–ù–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å *</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="create-initial_balance" value="0" step="0.01" required>
                                        <span class="input-group-text">‚ÇΩ</span>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <label class="form-label">–î–∞—Ç–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è</label>
                                    <input type="datetime-local" class="form-control" id="create-opened_at">
                                </div>
                                
                                <!-- –í–Ω–µ—à–Ω–∏–π –≤–∏–¥ -->
                                <div class="col-md-4">
                                    <label class="form-label">–ò–∫–æ–Ω–∫–∞</label>
                                    <select class="form-select" id="create-icon">
                                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏–∫–æ–Ω–∫—É...</option>
                                        <option value="credit_card">üí≥ –ö–∞—Ä—Ç–∞</option>
                                        <option value="cash">üí∞ –ù–∞–ª–∏—á–Ω—ã–µ</option>
                                        <option value="wallet">üëõ –ö–æ—à–µ–ª—ë–∫</option>
                                        <option value="piggy_bank">üê∑ –ö–æ–ø–∏–ª–∫–∞</option>
                                        <option value="bank">üè¶ –ë–∞–Ω–∫</option>
                                        <option value="bitcoin">‚Çø –ë–∏—Ç–∫–æ–∏–Ω</option>
                                    </select>
                                </div>
                                
                                <div class="col-md-4">
                                    <label class="form-label">–¶–≤–µ—Ç</label>
                                    <input type="color" class="form-control form-control-color" id="create-color" value="#6c757d" title="–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç">
                                </div>
                                
                                <div class="col-md-4">
                                    <label class="form-label">–ü–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏</label>
                                    <input type="number" class="form-control" id="create-sort_order" value="0" min="0">
                                </div>
                                
                                <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ -->
                                <div class="col-12">
                                    <label class="form-label">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</label>
                                    <textarea class="form-control" id="create-note" rows="2" maxlength="500"></textarea>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="create-is_active" checked>
                                        <label class="form-check-label">–ê–∫—Ç–∏–≤–Ω—ã–π —Å—á—ë—Ç</label>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="create-is_hidden">
                                        <label class="form-check-label">–°–∫—Ä—ã—Ç—ã–π —Å—á—ë—Ç</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="modal-footer mt-3">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                                <button type="button" class="btn btn-primary" onclick="createAccount()">
                                    <span class="spinner-border spinner-border-sm htmx-indicator" role="status" id="create-spinner"></span>
                                    –°–æ–∑–¥–∞—Ç—å —Å—á—ë—Ç
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å—á–µ—Ç–∞ -->
        <div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—á—ë—Ç–∞</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
                    </div>
                    <div class="modal-body" id="editModalBody">
                        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–¥–∞–ª–µ–Ω–∏—è -->
        <div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">–£–¥–∞–ª–µ–Ω–∏–µ —Å—á—ë—Ç–∞</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
                    </div>
                    <div class="modal-body">
                        <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Å—á—ë—Ç? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.</p>
                        <div class="alert alert-warning" role="alert">
                            <i class="bi bi-exclamation-triangle me-2"></i>
                            –í—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —ç—Ç–∏–º —Å—á—ë—Ç–æ–º, –æ—Å—Ç–∞–Ω—É—Ç—Å—è –≤ –∏—Å—Ç–æ—Ä–∏–∏.
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                        <button type="button" class="btn btn-danger" id="confirmDelete">
                            <span class="spinner-border spinner-border-sm htmx-indicator" role="status"></span>
                            –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentAccountId = null;
        let showHiddenAccounts = false;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—á–µ—Ç–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            loadAccounts();
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —É–¥–∞–ª–µ–Ω–∏—è
            document.getElementById('deleteModal').addEventListener('show.bs.modal', function(event) {
                const button = event.relatedTarget;
                currentAccountId = button.getAttribute('data-account-id');
            });
            
            // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è
            document.getElementById('confirmDelete').addEventListener('click', function() {
                if (currentAccountId) {
                    deleteAccount(currentAccountId);
                }
            });
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ HTMX –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ JSON
            htmx.config.useTemplateFragments = true;
        });
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —Å—á–µ—Ç–∞
        function createAccount() {
            const createBtn = document.querySelector('#createModal .btn-primary');
            const spinner = document.getElementById('create-spinner');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä
            createBtn.disabled = true;
            spinner.classList.remove('htmx-indicator');
            
            // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–æ—Ä–º—ã
            const accountData = {
                name: document.getElementById('create-name').value,
                bank_name: document.getElementById('create-bank_name').value || '',
                icon: document.getElementById('create-icon').value || '',
                color: document.getElementById('create-color').value,
                currency: document.getElementById('create-currency').value,
                type: document.getElementById('create-type').value,
                initial_balance: parseFloat(document.getElementById('create-initial_balance').value),
                opened_at: document.getElementById('create-opened_at').value || '',
                note: document.getElementById('create-note').value || '',
                sort_order: parseInt(document.getElementById('create-sort_order').value) || 0,
                is_active: document.getElementById('create-is_active').checked,
                is_hidden: document.getElementById('create-is_hidden').checked
            };
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
            if (!accountData.name || !accountData.type || !accountData.currency) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
                createBtn.disabled = false;
                spinner.classList.add('htmx-indicator');
                return;
            }
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ HTMX —Å JSON
            htmx.ajax('POST', '/api/accounts', {
                headers: {
                    'Content-Type': 'application/json'
                },
                values: accountData,
                swap: 'none',
                onSuccess: function() {
                    // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è
                    const createModal = bootstrap.Modal.getInstance(document.getElementById('createModal'));
                    if (createModal) createModal.hide();
                    
                    // –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É —Å–æ–∑–¥–∞–Ω–∏—è
                    document.getElementById('createForm').reset();
                    
                    // –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å—á–µ—Ç–æ–≤
                    loadAccounts();
                    
                    // –°–∫—Ä—ã—Ç—å —Å–ø–∏–Ω–Ω–µ—Ä
                    createBtn.disabled = false;
                    spinner.classList.add('htmx-indicator');
                },
                onError: function() {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å—á–µ—Ç–∞');
                    createBtn.disabled = false;
                    spinner.classList.add('htmx-indicator');
                }
            });
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—á–µ—Ç–æ–≤
        function loadAccounts() {
            htmx.ajax('GET', '/api/accounts', {
                target: '#accounts-list',
                swap: 'innerHTML',
                beforeSend: function() {
                    document.querySelector('#accounts-list').innerHTML = `
                        <div class="text-center">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—á–µ—Ç–æ–≤...</span>
                            </div>
                        </div>`;
                }
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞
        function updateAccount(accountId) {
            const form = document.getElementById('editForm');
            const submitBtn = form.querySelector('button[type="submit"]');
            const spinner = submitBtn.querySelector('.spinner-border');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä
            submitBtn.disabled = true;
            spinner.classList.remove('htmx-indicator');
            
            // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–æ—Ä–º—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            const accountData = {};
            
            // –°–æ–±–∏—Ä–∞–µ–º —Ç–æ–ª—å–∫–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ø–æ–ª—è
            const inputs = form.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                if (input.id && input.id.startsWith('edit-')) {
                    const fieldName = input.id.replace('edit-', '');
                    
                    if (input.type === 'checkbox') {
                        if (input.checked) {
                            accountData[fieldName] = input.checked;
                        }
                    } else if (input.type === 'number') {
                        if (input.value !== '') {
                            accountData[fieldName] = parseFloat(input.value);
                        }
                    } else if (input.value !== '') {
                        accountData[fieldName] = input.value;
                    }
                }
            });
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º PATCH –∑–∞–ø—Ä–æ—Å
            htmx.ajax('PATCH', `/api/accounts/${accountId}`, {
                headers: {
                    'Content-Type': 'application/json'
                },
                values: accountData,
                swap: 'none',
                onSuccess: function() {
                    const editModal = bootstrap.Modal.getInstance(document.getElementById('editModal'));
                    if (editModal) editModal.hide();
                    loadAccounts();
                    
                    // –°–∫—Ä—ã—Ç—å —Å–ø–∏–Ω–Ω–µ—Ä
                    submitBtn.disabled = false;
                    spinner.classList.add('htmx-indicator');
                },
                onError: function() {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—á–µ—Ç–∞');
                    submitBtn.disabled = false;
                    spinner.classList.add('htmx-indicator');
                }
            });
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞
        function deleteAccount(accountId) {
            const deleteBtn = document.getElementById('confirmDelete');
            const spinner = deleteBtn.querySelector('.spinner-border');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä
            deleteBtn.disabled = true;
            spinner.classList.remove('htmx-indicator');
            
            htmx.ajax('DELETE', `/api/accounts/${accountId}`, {
                swap: 'none',
                onSuccess: function() {
                    const deleteModal = bootstrap.Modal.getInstance(document.getElementById('deleteModal'));
                    if (deleteModal) deleteModal.hide();
                    loadAccounts();
                    
                    // –°–∫—Ä—ã—Ç—å —Å–ø–∏–Ω–Ω–µ—Ä
                    deleteBtn.disabled = false;
                    spinner.classList.add('htmx-indicator');
                },
                onError: function() {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å—á–µ—Ç–∞');
                    deleteBtn.disabled = false;
                    spinner.classList.add('htmx-indicator');
                }
            });
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–∫—Ä—ã—Ç—ã—Ö —Å—á–µ—Ç–æ–≤
        function toggleHiddenAccounts() {
            showHiddenAccounts = !showHiddenAccounts;
            const hiddenAccounts = document.querySelectorAll('.hidden-account');
            const btn = document.querySelector('[onclick="toggleHiddenAccounts()"]');
            
            if (showHiddenAccounts) {
                hiddenAccounts.forEach(account => {
                    account.style.display = 'block';
                });
                btn.classList.remove('btn-outline-secondary');
                btn.classList.add('btn-secondary');
                btn.innerHTML = '<i class="bi bi-eye"></i>';
            } else {
                hiddenAccounts.forEach(account => {
                    account.style.display = 'none';
                });
                btn.classList.remove('btn-secondary');
                btn.classList.add('btn-outline-secondary');
                btn.innerHTML = '<i class="bi bi-eye-slash"></i>';
            }
        }
        
        // –û—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function openEditForm(accountId) {
            htmx.ajax('GET', `/api/accounts/${accountId}`, {
                target: '#editModalBody',
                swap: 'innerHTML',
                beforeSend: function() {
                    document.querySelector('#editModalBody').innerHTML = `
                        <div class="text-center">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                            </div>
                        </div>`;
                },
                onSuccess: function() {
                    new bootstrap.Modal(document.getElementById('editModal')).show();
                }
            });
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML –¥–ª—è —Å—á–µ—Ç–∞
        function generateAccountCard(account) {
            const balanceClass = account.balance >= 0 ? 'balance-positive' : 'balance-negative';
            const hiddenClass = account.is_hidden ? 'hidden-account' : '';
            const activeBadge = account.is_active ? 
                '<span class="badge bg-success">–ê–∫—Ç–∏–≤–Ω—ã–π</span>' : 
                '<span class="badge bg-danger">–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–π</span>';
            const hiddenBadge = account.is_hidden ? '<span class="badge bg-secondary ms-1">–°–∫—Ä—ã—Ç—ã–π</span>' : '';
            
            return `
                <div class="col-12 col-md-6 col-lg-4 mb-3 ${hiddenClass}">
                    <div class="card account-card h-100" style="border-left-color: ${account.color || getColorByType(account.type)};">
                        <div class="card-body">
                            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫–∞—Ä—Ç–æ—á–∫–∏ -->
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <div>
                                    <span class="color-preview" style="background-color: ${account.color || getColorByType(account.type)};"></span>
                                    <h5 class="card-title mb-1 d-inline">${account.name}</h5>
                                    <div class="d-flex align-items-center mt-1">
                                        <span class="badge account-type-badge" style="background-color: ${getColorByType(account.type)};">
                                            ${getTypeName(account.type)}
                                        </span>
                                        <small class="text-muted ms-2">${account.bank_name || ''}</small>
                                    </div>
                                </div>
                                <div class="dropdown">
                                    <button class="btn btn-sm btn-outline-secondary border-0" type="button" data-bs-toggle="dropdown">
                                        <i class="bi bi-three-dots-vertical"></i>
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-end">
                                        <li>
                                            <a class="dropdown-item" href="#" onclick="openEditForm('${account.id}')">
                                                <i class="bi bi-pencil me-2"></i>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item text-danger" href="#" data-bs-toggle="modal" 
                                               data-bs-target="#deleteModal" data-account-id="${account.id}">
                                                <i class="bi bi-trash me-2"></i>–£–¥–∞–ª–∏—Ç—å
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            
                            <!-- –ë–∞–ª–∞–Ω—Å -->
                            <div class="mb-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="text-muted">–ë–∞–ª–∞–Ω—Å:</span>
                                    <span class="h4 mb-0 ${balanceClass}">${formatCurrency(account.balance, account.currency)}</span>
                                </div>
                                <small class="text-muted">–ù–∞—á–∞–ª—å–Ω—ã–π: ${formatCurrency(account.initial_balance, account.currency)}</small>
                            </div>
                            
                            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                            <div class="mb-3">
                                <div class="row small">
                                    <div class="col-6">
                                        <i class="bi bi-calendar me-1"></i>
                                        –û—Ç–∫—Ä—ã—Ç: ${formatDate(account.opened_at)}
                                    </div>
                                    <div class="col-6 text-end">
                                        ${activeBadge}
                                        ${hiddenBadge}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ -->
                            ${account.note ? `<p class="card-text small text-muted">${account.note}</p>` : ''}
                        </div>
                    </div>
                </div>
            `;
        }
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∏—Å–µ–ª
        function formatCurrency(amount, currency) {
            try {
                const formatter = new Intl.NumberFormat('ru-RU', {
                    style: 'currency',
                    currency: currency,
                    minimumFractionDigits: 2
                });
                return formatter.format(amount);
            } catch (e) {
                return `${amount} ${currency}`;
            }
        }
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã
        function formatDate(dateString) {
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('ru-RU', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
            } catch (e) {
                return dateString;
            }
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ –ø–æ —Ç–∏–ø—É
        function getColorByType(type) {
            const colors = {
                'cash': '#28a745',
                'debit_card': '#007bff',
                'credit_card': '#6f42c1',
                'savings': '#17a2b8',
                'investment': '#fd7e14',
                'deposit': '#20c997',
                'loan': '#dc3545',
                'crypto': '#f7931a',
                'other': '#6c757d'
            };
            return colors[type] || '#6c757d';
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–∏–ø–∞
        function getTypeName(type) {
            const names = {
                'cash': '–ù–∞–ª–∏—á–Ω—ã–µ',
                'debit_card': '–î–µ–±–µ—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞',
                'credit_card': '–ö—Ä–µ–¥–∏—Ç–Ω–∞—è –∫–∞—Ä—Ç–∞',
                'savings': '–ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π',
                'investment': '–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏',
                'deposit': '–í–∫–ª–∞–¥',
                'loan': '–ö—Ä–µ–¥–∏—Ç',
                'crypto': '–ö—Ä–∏–ø—Ç–æ',
                'other': '–î—Ä—É–≥–æ–µ'
            };
            return names[type] || type;
        }
    </script>
</body>
</html>